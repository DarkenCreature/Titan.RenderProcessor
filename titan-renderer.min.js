class TitanRenderProcessor{renderComponent(t,e=null){t.querySelectorAll("[bind-rerender]").forEach((e=>{e.template=e.innerHTML,t.registerEvent(e.getAttribute("bind-rerender"),{tgtElement:e,callBack:t=>{t.innerHTML=t.template,(new TitanRenderProcessor).render(t,t.closest("[ttn-role]").data,null)}}),e.removeAttribute("bind-rerender")})),this.render(t,null==e?t.data:e,null)}render(t,e,r=null){for(null==r&&(r=[]),"object"==typeof e&&r.push(e);null!=t.querySelector("[for-each]");)this.renderForEachLoops(t.querySelector("[for-each]"),e,r);this.renderBindings(t,e,r)}renderBindings(t,e,r){var i=this;[{tag:"bind-text",method:"bindText"},{tag:"bind-raw",method:"bindRaw"},{tag:"bind-class",method:"bindClass"},{tag:"bind-attribute",method:"bindAttribute"},{tag:"bind-value",method:"bindValue"},{tag:"bind-style",method:"bindStyle"},{tag:"bind-click",method:"bindClickEvent"},{tag:"bind-change",method:"bindChangeEvent"}].forEach((n=>{t.hasAttribute(n.tag)&&i[n.method](t,e,r),t.querySelectorAll(`[${n.tag}]`).forEach((t=>i[n.method](t,e,r)))}))}renderForEachLoops(t,e,r){var i=t.getAttribute("for-each"),n=t.hasAttribute("if")?t.getAttribute("if"):null,s=t.parentElement;s.template=s.innerHTML,s.tempForEachTemplate=t.outerHTML,t.removeAttribute("for-each"),t.removeAttribute("if");var a=[];r.forEach((t=>{a.push(t)}));var l=e;"$"==i?l=e:i.indexOf("$")>-1?l=e[i.split("$")[1]]:(i.split(".").forEach((t=>{a.push(l[t]),l=l[t]})),a.pop()),a.push(l),l.forEach((e=>{if(null==n||this.dissolveBinding(n,r,e,a)){t.insertAdjacentHTML("beforebegin",s.tempForEachTemplate);var r=s.querySelector("[for-each]");r.removeAttribute("for-each"),r.removeAttribute("if"),this.render(r,e,a),this.renderBindings(r,e,a)}})),s.removeChild(t),this.renderBindings(s,e,a)}bindText(t,e,r){var i=t.getAttribute("bind-text"),n=this.dissolveBinding(i,t,e,r);t.innerText=n,t.removeAttribute("bind-text")}bindRaw(t,e,r){var i=t.getAttribute("bind-raw"),n=this.dissolveBinding(i,t,e,r);t.innerHTML=n,t.removeAttribute("bind-raw")}bindClass(t,e,r){var i=t.getAttribute("bind-class"),n=this.dissolveBinding(i,t,e,r);""!=(n??"")&&t.classList.add(n),t.removeAttribute("bind-class")}bindAttribute(t,e,r){var i=t.getAttribute("bind-attribute"),n=this.dissolveBinding(i,t,e,r);""!=(n??"")&&t.setAttribute(n,""),t.removeAttribute("bind-attribute")}bindValue(t,e,r){var i=t.getAttribute("bind-value"),n=this.dissolveBinding(i,t,e,r);""!=(n??"")&&(t.value=n),t.removeAttribute("bind-value")}bindStyle(t,e,r){var i=t.getAttribute("bind-style"),n=this.dissolveBinding(i,t,e,r);""!=(n??"")&&t.setAttribute("style",t.hasAttribute("style")?t.getAttribute("style")+" "+n:n),t.removeAttribute("bind-style")}dissolveBinding(t,e,r,i){return"{"==t.substring(0,1)?this.getBindingExpression(r,i,t):this.getBindingValue(r,i,t)}getBindingExpression(context,contextHistory,path){var regex=/\[[A-Z|a-z|0-9|.|\/| ]{0,99}\]/g,matches=path.match(regex);return null!=matches&&matches.forEach((t=>{var e=this.getBindingValue(context,contextHistory,t.slice(1,-1));"string"==typeof e&&(e=`'${e}'`),path=path.replace(t,e)})),eval(path.slice(1,-1))}getBindingValue(t,e,r){if("$"==r)return t??"";var i=(r.match(/.\//g)||[]).length;if(r=r.replaceAll("./",""),0==i)try{return t[r]??""}catch{return""}else try{return e[e.length-1-i][r]??""}catch{return""}}bindChangeEvent(t,e,r){var i=t.getAttribute("bind-change"),n=this.dissolveBinding(i,t,e,r);n||"{"==i.substring(0,1)||(n=i),null!=n&&""!=n&&(t.clickHandler={method:n,target:t.closest(`[ttn-role="${t.getAttribute("bind-target")??"component"}"]`),args:{}},this.fetchArgs(t,e,r),t.addEventListener("change",(function(){this.clickHandler.args.value=this.value,this.clickHandler.target[this.clickHandler.method](this,this.clickHandler.args)})),t.style.cursor="pointer"),t.removeAttribute("bind-change"),t.removeAttribute("bind-target"),t.removeAttribute("args")}fetchArgs(t,e,r){null!=t.getAttribute("args")&&t.getAttribute("args").split(",").forEach((i=>{var n=i,s=null;2==i.split("=").length?(n=i.split("=")[0],s=this.getBindingValue(e,r,i.split("=")[1])):s=this.getBindingValue(e,r,i),t.clickHandler.args[n]=s}))}bindClickEvent(t,e,r){var i=t.getAttribute("bind-click"),n=this.dissolveBinding(i,t,e,r);n||"{"==i.substring(0,1)||(n=i),null!=n&&""!=n&&(t.clickHandler={method:n,target:t.closest(`[ttn-role="${t.getAttribute("bind-target")??"component"}"]`),args:{}},this.fetchArgs(t,e,r),t.addEventListener("click",(function(){this.clickHandler.target[this.clickHandler.method](this,this.clickHandler.args)})),t.style.cursor="pointer"),t.removeAttribute("bind-click"),t.removeAttribute("bind-target"),t.removeAttribute("args")}}class TitanComponent extends HTMLElement{constructor(){super(),this._state={},this.$__eventSheduler=[]}getRemoveAttribute(t){var e=this.getAttribute(t);return this.removeAttribute(t),e}raiseEvent(t){null!=this.$__eventSheduler[t]&&this.$__eventSheduler[t].forEach((t=>{t.callBack(t.tgtElement)}))}registerEvent(t,e){null==this.$__eventSheduler[t]&&(this.$__eventSheduler[t]=[]),this.$__eventSheduler[t].push(e)}connectedCallback(){this.preRender(),this.render()}preRender(){this.hasAttribute("[ttn-role]")||this.setAttribute("ttn-role","component")}createDeepProxy(t,e=null){return new Proxy(t,{get:(t,e)=>{const r=t[e];return r&&"object"==typeof r?this.createDeepProxy(r,t):r},set:(t,e,r)=>(t[e]=r,this.render(),!0)})}}
